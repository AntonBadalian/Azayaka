name: macOS App Build

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install dependencies
        run: |
          sudo xcode-select -switch /Applications/Xcode.app
          xcodebuild -version

      - name: Build macOS app
        run: |
          xcodebuild -scheme Azayaka \
          -destination 'platform=macOS,arch=arm64,name=My Mac' \
          -derivedDataPath ./build_output \
          -sdk macosx \
          -configuration Release \
          clean build \
          -verbose \
          CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO

      - name: Archive app
        run: |
          ls -a
          ls -a /
          ls -a ./build_output
          rm -rf build/artifacts
          mkdir -p build/artifacts
          cp -r ./build_output build/artifacts/
          ls -a build/artifacts/

      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: release-artifacts
          path: /build/artifacts/
